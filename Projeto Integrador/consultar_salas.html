<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consultar Salas - UniCEUB</title>
    <link rel="stylesheet" href="estilo.css">
  </head>
  <body>
    <nav>
      <div class="logo">UniCEUB</div>
      <ul class="menu">
        <li><a href="inicio.html">Início</a></li>
        <li><a href="consultar_salas.html">Consultar Salas</a></li>
        <li><a href="reservar.html">Fazer Reserva</a></li>
        <li><a href="historico.html">Minhas Reservas</a></li>
        <li><a href="cancelar.html">Cancelar Reservas</a></li>
        <li class="login"><a href="login.html">Entrar</a></li>
      </ul>
    </nav>

    <main>
      <section class="filtros-container">
        <div class="form-row">
          <div class="filtro-box">
            <label for="bloco">Bloco:</label>
            <select id="bloco">
              <option value="todos">Todos</option>
              <option value="bloco1">Bloco 1</option>
              <option value="bloco2">Bloco 2</option>
              <option value="bloco3">Bloco 3</option>
            </select>
          </div>

          <div class="filtro-box">
            <label for="tipo">Tipo de Sala:</label>
            <select id="tipo">
              <option value="todos">Todos</option>
              <option value="laboratorio">Laboratório</option>
              <option value="sala_aula">Sala de Aula</option>
              <option value="auditorio">Auditório</option>
              <option value="sala_reuniao">Sala de Reunião</option>
            </select>
          </div>
        </div>

      

        <div class="form-row full">
          <button class="filtrar-btn" onclick="filtrarSalas()">Filtrar</button>
        </div>
      </section>

      <section class="salas-container">
        <section class="salas-container">
  <h2>Salas Disponíveis</h2>
  <div id="salas-lista">
    <!-- As salas vindas do backend serão inseridas aqui -->
  </div>
</section>

      </section>
    </main>

    <footer>
      <p>&copy; 2025 UniCEUB - Todos os direitos reservados.</p>
    </footer>

    <script>
      async function carregarSalas() {
  try {
    const response = await fetch('/api/salas');
    if (!response.ok) throw new Error('Erro ao carregar salas');
    const salas = await response.json();
    mostrarSalas(salas);
  } catch (e) {
    document.getElementById('salas-lista').innerHTML = `<p>Erro ao carregar salas.</p>`;
    console.error(e);
  }
}

function mostrarSalas(salas) {
  const container = document.getElementById('salas-lista');
  container.innerHTML = ''; // Limpa antes

  salas.forEach((sala) => {
    const div = document.createElement('div');
    div.className = 'sala-card';
    div.dataset.bloco = sala.bloco;
    div.dataset.tipo = sala.tipo;
    div.dataset.disponivel = sala.disponivel;

    div.innerHTML = `
      <h3>${sala.nome}</h3>
      <p><strong>Bloco:</strong> ${sala.bloco.replace('bloco', '')}</p>
      <p><strong>Capacidade:</strong> ${sala.capacidade} ${sala.capacidade > 1 ? 'alunos' : 'aluno'}</p>
      <p><strong>Recursos:</strong> ${sala.recursos}</p>
      <div class="status ${sala.disponivel ? 'disponivel' : 'ocupado'}">
        ${sala.disponivel ? 'Disponível' : 'Ocupado'}
      </div>
      <button class="reservar-btn" ${!sala.disponivel ? 'disabled class="disabled"' : ''} onclick="window.location.href='reservar.html?sala=${sala.id}'">
        ${sala.disponivel ? 'Reservar' : 'Indisponível'}
      </button>
    `;
    container.appendChild(div);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  carregarSalas();

  // Se quiser, pode criar um filtro que refaça o fetch ou filtre a lista carregada
});

      function filtrarSalas() {
        const filtroBloco = document.getElementById('bloco').value;
        const filtroTipo = document.getElementById('tipo').value;
  

        const cards = document.querySelectorAll('.sala-card');

        cards.forEach((card) => {
          const bloco = card.getAttribute('data-bloco');
          const tipo = card.getAttribute('data-tipo');
          const disponivel = card.getAttribute('data-disponivel') === 'true';

          let exibir = true;

          // Filtro de bloco
          if (filtroBloco !== 'todos' && bloco !== filtroBloco) {
            exibir = false;
          }

          // Filtro de tipo de sala
          if (filtroTipo !== 'todos' && tipo !== filtroTipo) {
            exibir = false;
          }

          

          // Mostrar ou ocultar
          card.style.display = exibir ? 'block' : 'none';
        });
      }
    </script>
  </body>
</html>